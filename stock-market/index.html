<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Gie≈Çda Szalona</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: #111;
      color: #f5f5f5;
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
    }
    .tabs {
      display: flex;
      overflow-x: auto;
      margin-bottom: 20px;
    }
    .tab {
      background: #333;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 8px 8px 0 0;
      margin-right: 5px;
    }
    .tab.active {
      background: #ffd700;
      color: #000;
    }
    .content {
      background: #222;
      padding: 20px;
      border-radius: 0 0 12px 12px;
    }
    .chart-container {
      width: 100%;
      max-width: 800px;
      margin: auto;
    }
    canvas {
      max-height: 300px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 5px;
      border-radius: 5px;
      border: none;
    }
    button {
      background: #ffd700;
      color: #000;
      cursor: pointer;
    }
    .stats {
      margin: 10px 0;
      font-size: 18px;
    }
    .hell {
      background: #300;
      color: #f55;
    }
  </style>
</head>
<body>
  <div class="tabs" id="tabBar"></div>
  <div class="content">
    <div>
      <input id="username" placeholder="Twoje imiƒô" />
      <input id="amount" placeholder="Ilo≈õƒá" type="number" />
      <button onclick="buy()">Kup</button>
      <button onclick="sell()">Sprzedaj</button>
    </div>
    <div>
      <button onclick="buyAll()">Kup wszystkie</button>
      <button onclick="sellAll()">Sprzedaj wszystkie</button>
    </div>
    <div class="stats" id="info"></div>
    <div class="chart-container">
      <canvas id="chart"></canvas>
    </div>
  </div>

  <script>
    const url = "";
    const currencies = ["ALFA", "BETA", "GAMMA", "DELTA", "OMEGA"];
    const portfolio = JSON.parse(localStorage.getItem("portfolio") || "{}");
    let balance = parseFloat(localStorage.getItem("balance") || "1000");
    let username = localStorage.getItem("username") || "";
    let activeCurrency = currencies[0];
    let hellMode = false;
    const ctx = document.getElementById("chart").getContext("2d");
    let chart;
    let tabBar = document.getElementById("tabBar");
    const info = document.getElementById("info");

    document.getElementById("username").value = username;

    function roundTime5s(ts = Date.now()) {
      return Math.floor(ts / 5000) * 5000;
    }

    function getTimestamps() {
      const now = Date.now();
      const timestamps = [];
      for (let i = 29; i >= 0; i--) {
        timestamps.push(roundTime5s(now - i * 5000));
      }
      return timestamps;
    }

    function seedRand(seed) {
      let x = Math.sin(seed) * 10000;
      return x - Math.floor(x);
    }
    

    function getPrice(currency, timestamp) {
      const t = roundTime5s(timestamp);
      const day = new Date(t).getDate();
      const chaos = seedRand(t / 123456 + currency.length * 999 + day);
      switch (currency) {
        case "ALFA":
          return 50 + Math.sin(t / 13333) * 8 + chaos * 5;
        case "BETA":
          return Math.abs(30 + Math.cos(t / 7777) * 12 + Math.sin(t / 2222 * chaos + chaos * 3) * Math.tan(day/chaos*3));
        case "GAMMA":
          return 80 + (Math.pow(Math.sin(t / 10000), 3) + chaos) * 15;
        case "DELTA":
          return 10 + Math.abs(Math.tan(t / 66666 + chaos)) % 20;
        case "OMEGA":
          return 100 + (Math.sin(t / 4444) * Math.cos(t / 3210) + chaos) * 25;
        default:
          return 1;
      }
    }

    function updateChart() {
	  const now = roundTime5s(Date.now());
	
	  // Je≈õli zmieniamy zak≈Çadkƒô (wykres ju≈º istnieje i jest z innƒÖ walutƒÖ),
	  // to tworzymy nowy wykres od zera dla activeCurrency
	  if (chart && chart.data.datasets[0].label !== activeCurrency) {
	    chart.destroy();
	    chart = null;
	  }
	
	  if (!chart) {
	    const timestamps = getTimestamps();
	    const data = timestamps.map(t => getPrice(activeCurrency, t));
	    const labels = timestamps.map(t => new Date(t).toLocaleTimeString());
	
	    chart = new Chart(ctx, {
	      type: "line",
	      data: {
	        labels: labels,
	        datasets: [{
	          label: activeCurrency,
	          data: data,
	          borderColor: "#ffd700",
	          borderWidth: 2,
	          fill: false,
	          tension: 0.3
	        }]
	      },
	      options: {
	        animation: false,
	        scales: { y: { beginAtZero: false }},
	        plugins: { legend: { display: false } }
	      }
	    });
	  } else {
	    const price = getPrice(activeCurrency, now);
	    const label = new Date(now).toLocaleTimeString();
	    const lastLabel = chart.data.labels[chart.data.labels.length - 1];
	    if (lastLabel !== label) {
	      chart.data.labels.push(label);
	      chart.data.labels.shift();
	      chart.data.datasets[0].data.push(price);
	      chart.data.datasets[0].data.shift();
	      chart.update("none");
	    }
	  }
	
	  const current = chart.data.datasets[0].data[chart.data.datasets[0].data.length - 1];
	  const prev = chart.data.datasets[0].data[0];
	  const owned = portfolio[activeCurrency] || 0;
	  const maxBuy = hellMode ? "‚àû" : (balance / current).toFixed(2);
	  const change = (((current - prev) / prev) * 100).toFixed(2);
	
	  info.innerHTML = `
	    üí± Kurs: $${current.toFixed(2)}<br/>
	    üìà Zmiana 5m: ${change}%<br/>
	    üéí Masz: ${owned.toFixed(2)} ${activeCurrency}<br/>
	    üí∞ Mo≈ºesz kupiƒá: ${maxBuy} jednostek<br/>
	    üè¶ Saldo: $${balance.toFixed(2)}<br/>
            üí≤ Warto≈õƒá: $${(owned*current).toFixed(2)}
	  `;
	}

    function buildTabs() {
      tabBar.innerHTML = "";
      currencies.forEach(c => {
        const el = document.createElement("div");
        let own = portfolio[c]
        if (own === undefined) own = 0;
        el.textContent = c + " " + own;
        el.className = "tab" + (c === activeCurrency ? " active" : "");
        el.onclick = () => {
          activeCurrency = c;
          buildTabs();
          updateChart();
        };
        tabBar.appendChild(el);
      });
    }

    function sendToWebhook(action, currency, amount, price) {
      fetch(url + "88", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          content: `üßæ **${action}**\nüë§ ${username}\nüí± ${currency}\nüî¢ ${amount}\nüíµ $${price.toFixed(2)}\nüí∞ Saldo: $${balance.toFixed(2)}\nüéí Portfel: ${JSON.stringify(portfolio)}`
        })
      });
    }

    function buy() {
      username = document.getElementById("username").value.trim() || "Anon";
      localStorage.setItem("username", username);
      const amount = parseFloat(document.getElementById("amount").value);
      if (amount === 192168) {
        localStorage.clear(); location.reload(); return;
      }
      if (isNaN(amount) || amount <= 0) return alert("Podaj poprawnƒÖ ilo≈õƒá");
      const price = getPrice(activeCurrency, Date.now());
      const cost = amount * price;
      if (!hellMode && cost > balance) return alert("Za ma≈Ço ≈õrodk√≥w");
      portfolio[activeCurrency] = (portfolio[activeCurrency] || 0) + amount;
      if (!hellMode) balance -= cost;
      save();
      sendToWebhook("Kupno", activeCurrency, amount, price);
      updateChart();
    }

    function sell() {
      const amount = parseFloat(document.getElementById("amount").value);
      if (isNaN(amount) || amount <= 0) return alert("Podaj poprawnƒÖ ilo≈õƒá");
      const owned = portfolio[activeCurrency] || 0;
      if (amount > owned) return alert("Za ma≈Ço jednostek");
      const price = getPrice(activeCurrency, Date.now());
      portfolio[activeCurrency] -= amount;
      balance += amount * price;
      save();
      sendToWebhook("Sprzeda≈º", activeCurrency, amount, price);
      updateChart();
    }

    function buyAll() {
      username = document.getElementById("username").value.trim() || "Anon";
      localStorage.setItem("username", username);
      const price = getPrice(activeCurrency, Date.now());
      if (price <= 0) return alert("B≈Çƒôdny kurs");
      if (hellMode) {
        alert("Tryb piekielny - kupujesz niesko≈ÑczonƒÖ ilo≈õƒá");
        portfolio[activeCurrency] = Infinity;
      } else {
        const maxAmount = Math.floor(balance / price * 100) / 100; // zaokrƒÖglenie do 2 miejsc
        if (maxAmount <= 0) return alert("Za ma≈Ço ≈õrodk√≥w");
        portfolio[activeCurrency] = (portfolio[activeCurrency] || 0) + maxAmount;
        balance -= maxAmount * price;
      }
      save();
      sendToWebhook("Kupno wszystkie", activeCurrency, portfolio[activeCurrency], price);
      updateChart();
    }

    function sellAll() {
      const owned = portfolio[activeCurrency] || 0;
      if (owned <= 0) return alert("Nie masz ≈ºadnych jednostek do sprzeda≈ºy");
      const price = getPrice(activeCurrency, Date.now());
      portfolio[activeCurrency] = 0;
      balance += owned * price;
      save();
      sendToWebhook("Sprzeda≈º wszystkie", activeCurrency, owned, price);
      updateChart();
    }

    function save() {
      localStorage.setItem("balance", balance);
      localStorage.setItem("portfolio", JSON.stringify(portfolio));
    }

    setInterval(updateChart, 5000);
    buildTabs();
    updateChart();
  </script>
</body>
</html>
