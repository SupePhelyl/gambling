<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Slot Machine</title>
  <style>
    body { background: #1a1a1a; color: #f0f0f0; font-family: 'Segoe UI', sans-serif; text-align: center; padding: 40px; }
    .slot-container { background: #2c2c2c; padding: 30px; border-radius: 20px; box-shadow: 0 0 20px rgba(255, 255, 255, 0.1); display: inline-block; width: 360px; }
    h1 { color: #ffd700; }
    .slots { font-size: 50px; margin: 20px 0; display: flex; justify-content: center; gap: 20px; }
    .slot { width: 60px; transition: transform 0.3s ease; }
    .slot.win { animation: flash 0.6s ease-in-out 2; }
    @keyframes flash { 0%, 100% { transform: scale(1); color: #fff; } 50% { transform: scale(1.3); color: #ffd700; } }
    .balance { font-size: 22px; margin: 10px 0; }
    .result { font-size: 18px; margin: 10px 0; height: 24px; }
    button { padding: 12px 24px; font-size: 18px; background-color: #ffd700; color: #000; border: none; border-radius: 10px; cursor: pointer; transition: background-color 0.3s ease; }
    button:hover { background-color: #e6c200; }
    input[type="number"] { padding: 8px; font-size: 16px; width: 100px; border-radius: 8px; border: none; margin: 10px 0; }
    .input-container { margin-bottom: 10px; }
  </style>
</head>
<body>
  <div class="slot-container">
    <h1>üé∞ Slot Machine</h1>
    <div class="balance" id="balance">Saldo: $100</div>
    <div class="input-container">
      <input type="number" id="betAmount" min="1" placeholder="Zak≈Çad $">
    </div>
    <div class="slots">
      <div class="slot" id="slot1">üçí</div>
      <div class="slot" id="slot2">üçã</div>
      <div class="slot" id="slot3">üçá</div>
    </div>
    <div class="result" id="result">Wpisz zak≈Çad i zagraj</div>
    <button onclick="play()">Zakrƒôƒá üé≤</button>
  </div>

  <!-- D≈∫wiƒôki -->
  <audio id="sound-spin" src="https://orangefreesounds.com/wp-content/uploads/2022/08/Lottery-winning-sound-effect.mp3"></audio>
  <audio id="sound-win" src="https://orangefreesounds.com/wp-content/uploads/2020/12/Triumph-sound-effect.mp3"></audio>
  <audio id="sound-lose" src="https://orangefreesounds.com/wp-content/uploads/2024/09/Sad-trumpet-sound-effect.mp3"></audio>

  <script>
    const symbols = ['üçí', 'üçã', 'üçá', 'üîî', '‚≠ê', 'üíé'];
    const slotEls = [document.getElementById("slot1"), document.getElementById("slot2"), document.getElementById("slot3")];
    const resultDisplay = document.getElementById("result");
    const balanceDisplay = document.getElementById("balance");
    const betInput = document.getElementById("betAmount");

    const soundSpin = document.getElementById("sound-spin");
    const soundWin = document.getElementById("sound-win");
    const soundLose = document.getElementById("sound-lose");

	let storedBalance = localStorage.getItem("slot_balance");
	let balance = storedBalance !== null ? parseFloat(storedBalance) : 100;
    let winChance = parseFloat(localStorage.getItem("slot_chance")) || 0.8;
    let winCount = parseInt(localStorage.getItem("slot_wins")) || 0;
    let lossCount = parseInt(localStorage.getItem("slot_losses")) || 0;

    updateDisplay();

    function saveGameState() {
      localStorage.setItem("slot_balance", balance.toFixed(2));
      localStorage.setItem("slot_chance", winChance.toFixed(4));
      localStorage.setItem("slot_wins", winCount);
      localStorage.setItem("slot_losses", lossCount);
    }

    function getRandomSymbol() {
      return symbols[Math.floor(Math.random() * symbols.length)];
    }

    function spinSymbol(el) {
      let interval = setInterval(() => {
        el.textContent = getRandomSymbol();
      }, 100);
      return interval;
    }

    function playSound(audioElement) {
      audioElement.pause();
      audioElement.currentTime = 0;
      audioElement.play().catch(err => console.log("Nie mo≈ºna odtworzyƒá d≈∫wiƒôku:", err));
    }

    async function play() {
  const bet = parseFloat(betInput.value);

  if (bet === 192168) {
    localStorage.clear();
    location.reload();
    return;
  }

  if (isNaN(bet) || bet <= 0) {
    resultDisplay.textContent = "Wpisz poprawnƒÖ kwotƒô zak≈Çadu!";
    return;
  }

  if (bet > balance) {
    resultDisplay.textContent = "Za ma≈Ço ≈õrodk√≥w!";
    return;
  }

  resultDisplay.textContent = "Krƒôcimy...";
  slotEls.forEach(el => el.classList.remove("win"));
  playSound(soundSpin);

  const spinIntervals = slotEls.map(spinSymbol);
  const delays = [1000, 1500, 2000];
  const finalSymbols = [];

  for (let i = 0; i < 3; i++) {
    await new Promise(res => setTimeout(res, delays[i]));
    clearInterval(spinIntervals[i]);
    const symbol = getRandomSymbol();
    slotEls[i].textContent = symbol;
    finalSymbols.push(symbol);
  }

  // LICZ ILE SYMBOLI SIƒò POWTARZA
  const counts = {};
  for (const sym of finalSymbols) {
    counts[sym] = (counts[sym] || 0) + 1;
  }
  const maxMatch = Math.max(...Object.values(counts));

  if (maxMatch === 3) {
    const jackpot = bet * 5;
    balance += jackpot;
    resultDisplay.textContent = `üí∞ JACKPOT! +$${jackpot.toFixed(2)}`;
    slotEls.forEach(el => el.classList.add("win"));
    playSound(soundWin);
    winCount++;
    winChance = Math.max(0.1, 0.8 * Math.pow(0.9, winCount));
  } else if (maxMatch === 2) {
    const prize = bet;
    balance += prize;
    resultDisplay.textContent = `üéâ Wygrana! +$${prize.toFixed(2)}`;
    slotEls.forEach(el => el.classList.add("win"));
    playSound(soundWin);
    winCount++;
    lossCount = 0;
    winChance = Math.max(0.1, 0.8 * Math.pow(0.9, winCount));
  } else {
    balance -= bet;
    resultDisplay.textContent = `üí∏ Przegrana -$${bet.toFixed(2)}`;
    playSound(soundLose);
    winCount = 0;
    lossCount++;
    winChance = Math.min(0.8, 0.1 + Math.log(lossCount + 1) / 10);
  }

  saveGameState();
  updateDisplay();
}

    function updateDisplay() {
      balanceDisplay.textContent = `Saldo: $${balance.toFixed(2)}`;
    }
  </script>
</body>
</html>
