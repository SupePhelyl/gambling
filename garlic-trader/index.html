<!DOCTYPE html><html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Garlic Trader</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: #111;
      color: #f5f5f5;
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
    }
    .tabs, .subtabs {
      display: flex;
      overflow-x: auto;
      margin-bottom: 10px;
    }
    .tab, .subtab {
      background: #333;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 8px 8px 0 0;
      margin-right: 5px;
    }
    .tab.active, .subtab.active {
      background: #ffd700;
      color: #000;
    }
    .content {
      background: #222;
      padding: 20px;
      border-radius: 0 0 12px 12px;
    }
    .hidden {
      display: none;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .status {
      font-size: 16px;
    }
    .button {
      background: #ffd700;
      color: #000;
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .disabled {
      pointer-events: none;
      opacity: 0.4;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <div class="status">
      ğŸ§„ Czosnek: <span id="garlic-count">-</span> | ğŸ’µ $: <span id="money-count">-</span>
    </div>
    <div>
      <button class="button" id="login-btn">Zaloguj siÄ™</button>
      <button class="button hidden" id="logout-btn">Wyloguj siÄ™</button>
    </div>
  </div>  <h1>Garlic TraderğŸ§„</h1>  <div class="tabs" id="mainTabs">
    <div class="tab disabled" data-tab="market">Market</div>
    <div class="tab disabled" data-tab="farm">Farma</div>
    <div class="tab active" data-tab="toplist">Top listy</div>
  </div>  <div class="content">
    <div id="market" class="tab-content hidden">
      <div class="subtabs">
        <div class="subtab active" data-subtab="buy">KupiÄ™</div>
        <div class="subtab" data-subtab="sell">Sprzedam</div>
      </div>
      <div id="buy" class="subtab-content">
        <p>ğŸ›’ Kup czosnek na rynku!</p>
      </div>
      <div id="sell" class="subtab-content hidden">
        <p>ğŸ’° Sprzedaj swÃ³j czosnek innym graczom!</p>
      </div>
    </div><div id="farm" class="tab-content hidden">
  <p>Farma czosnku â€“ tu moÅ¼esz zasadziÄ‡, zebraÄ‡ i zarzÄ…dzaÄ‡ zasobami.</p>
</div>

<div id="toplist" class="tab-content">
  <p>ğŸ¥‡ Top gracze wg iloÅ›ci czosnku:</p>
  <div id="top-garlic">Åadowanie...</div>
  <p>ğŸ’µ Top gracze wg iloÅ›ci pieniÄ™dzy:</p>
  <div id="top-money">Åadowanie...</div>
</div>

  </div>  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, collection, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCo4E88eJrumSph1gyizPxMG2nn2YyMVx8",
      authDomain: "gielda-20172.firebaseapp.com",
      projectId: "gielda-20172",
      storageBucket: "gielda-20172.appspot.com",
      messagingSenderId: "985455770805",
      appId: "1:985455770805:web:a80aaf536a6a5d064c52fc",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const loginBtn = document.getElementById("login-btn");
    const logoutBtn = document.getElementById("logout-btn");
    const garlicCount = document.getElementById("garlic-count");
    const moneyCount = document.getElementById("money-count");
    const tabs = document.querySelectorAll('.tab');

    let currentUser = null;

    loginBtn.onclick = async () => {
      const provider = new GoogleAuthProvider();
      await signInWithPopup(auth, provider);
    };

    logoutBtn.onclick = async () => {
      await signOut(auth);
    };

    onAuthStateChanged(auth, async user => {
      if (user) {
        currentUser = user;
        loginBtn.classList.add("hidden");
        logoutBtn.classList.remove("hidden");
        await loadOrCreatePlayer(user);
        enableRestrictedTabs();
      } else {
        currentUser = null;
        loginBtn.classList.remove("hidden");
        logoutBtn.classList.add("hidden");
        garlicCount.textContent = "-";
        moneyCount.textContent = "-";
        disableRestrictedTabs();
        switchToToplist();
      }
    });

    function enableRestrictedTabs() {
      tabs.forEach(tab => {
        if (tab.dataset.tab === "market" || tab.dataset.tab === "farm") {
          tab.classList.remove("disabled");
        }
      });
    }

    function disableRestrictedTabs() {
      tabs.forEach(tab => {
        if (tab.dataset.tab === "market" || tab.dataset.tab === "farm") {
          tab.classList.add("disabled");
        }
      });
    }

    function switchToToplist() {
      tabs.forEach(tab => tab.classList.remove("active"));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
      const toplistTab = [...tabs].find(t => t.dataset.tab === 'toplist');
      toplistTab.classList.add("active");
      document.getElementById('toplist').classList.remove("hidden");
    }

    async function loadOrCreatePlayer(user) {
      const ref = doc(db, "garlic-leaderboard", user.uid);
      const snap = await getDoc(ref);
      if (!snap.exists()) {
        await setDoc(ref, { name: user.displayName, garlic: 0, money: 100 });
        garlicCount.textContent = 0;
        moneyCount.textContent = 100;
      } else {
        const data = snap.data();
        garlicCount.textContent = data.garlic;
        moneyCount.textContent = data.money;
      }
    }

    async function loadTopLists() {
      const garlicDiv = document.getElementById("top-garlic");
      const moneyDiv = document.getElementById("top-money");

      try {
        const ref = collection(db, "garlic-leaderboard");

        const garlicQ = query(ref, orderBy("garlic", "desc"), limit(10));
        const moneyQ = query(ref, orderBy("money", "desc"), limit(10));

        const garlicSnap = await getDocs(garlicQ);
        const moneySnap = await getDocs(moneyQ);

        garlicDiv.innerHTML = "<ol>" + garlicSnap.docs.map(doc => `<li>${doc.data().name}: ${doc.data().garlic}</li>`).join("") + "</ol>";
        moneyDiv.innerHTML = "<ol>" + moneySnap.docs.map(doc => `<li>${doc.data().name}: $${doc.data().money}</li>`).join("") + "</ol>";
      } catch (e) {
        garlicDiv.textContent = moneyDiv.textContent = "BÅ‚Ä…d Å‚adowania top list.";
        console.error(e);
      }
    }

    loadTopLists();

    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        if (tab.classList.contains('disabled')) return;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.remove('hidden');
      });
    });

    document.querySelectorAll('.subtab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.subtab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.subtab-content').forEach(c => c.classList.add('hidden'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.subtab).classList.remove('hidden');
      });
    });
  </script></body>
</html>
